#!/bin/bash
set -euo pipefail

TARGET_DIR="$HOME/Repository/aur"
PACKAGE_LIST="$HOME/my-arch/aur.txt"

# Colors (most TTYs support)
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
RED="\033[1;31m"
BLUE="\033[1;34m"
NC="\033[0m" # no color

mkdir -p "$TARGET_DIR"
cd "$TARGET_DIR"

echo -e "${BLUE}=== Starting AUR clone process ===${NC}"
echo

while IFS= read -r package || [[ -n "$package" ]]; do
    # Trim whitespace
    package="$(echo "$package" | xargs)"

    # Skip empty lines or comments
    [[ -z "$package" || "$package" =~ ^# ]] && continue

    aur_url="https://aur.archlinux.org/${package}.git"

    if [[ -d "$package/.git" ]]; then
        echo -e "${YELLOW}[UPDATE] $package already exists. Pulling changes...${NC}"
        git -C "$package" pull
        echo -e "\n----------------------------------------\n"
        continue
    fi

    echo -e "${GREEN}[CLONE] $package from AUR...${NC}"
    if git clone "$aur_url"; then
        echo -e "${GREEN}[SUCCESS] $package cloned!${NC}"
    else
        echo -e "${RED}[FAIL] Could not clone $package${NC}"
    fi

    # Separator for readability
    echo -e "\n----------------------------------------\n"

done < "$PACKAGE_LIST"

echo -e "${BLUE}=== AUR clone process completed in $TARGET_DIR ===${NC}"
